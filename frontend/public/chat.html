<!DOCTYPE html>
<html lang="es" data-lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Capibara6 Consensus - Sistema de IA con GPT-OSS 20B (20.9B par√°metros)">
    <title>Capibara6 Consensus | Anachroni</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="chat.css?v=11.0">
    <link rel="stylesheet" href="chat-consensus.css?v=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Marked.js para renderizar Markdown -->
    <script src="https://cdn.jsdelivr.net/npm/marked@11.1.1/marked.min.js"></script>
    <!-- Highlight.js para syntax highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
</head>
<body class="chat-page">
    <!-- Barra lateral -->
    <aside id="sidebar" class="sidebar hidden">
        <div class="sidebar-header">
            <a href="index.html" class="sidebar-logo">
                <h1 class="logo-gradient">capibara6</h1>
            </a>
            <button id="new-chat-btn" class="btn-new-chat">
                <i data-lucide="edit-3" style="width: 20px; height: 20px;"></i>
                <span data-i18n="chat.new">Nueva Conversaci√≥n</span>
            </button>
        </div>

        <div class="sidebar-content">
            <!-- Informaci√≥n del usuario -->
            <div id="user-info" class="user-info" style="display: none;">
                <img src="" alt="Avatar" class="user-avatar">
                <div class="user-details">
                    <span class="user-name">Usuario</span>
                    <span class="user-provider">provider</span>
                </div>
            </div>
            
            <!-- Tabs para Conversaciones / Agentes -->
            <div class="sidebar-tabs">
                <button class="sidebar-tab active" data-tab="chats">
                    <i data-lucide="messages-square" style="width: 16px; height: 16px;"></i>
                    <span data-i18n="sidebar.chats">Chats</span>
                </button>
                <button class="sidebar-tab" data-tab="agents">
                    <i data-lucide="sparkles" style="width: 16px; height: 16px;"></i>
                    <span data-i18n="sidebar.agents">Agentes</span>
                </button>
            </div>

            <!-- Tab: Conversaciones -->
            <div id="tab-chats" class="tab-content active">
                <div class="sidebar-section">
                    <h3 class="sidebar-section-title" data-i18n="chat.today">Hoy</h3>
                    <div id="chats-today" class="chat-list">
                        <!-- Se llenar√°n din√°micamente -->
                    </div>
                </div>

                <div class="sidebar-section">
                    <h3 class="sidebar-section-title" data-i18n="chat.previous">Anteriores</h3>
                    <div id="chats-previous" class="chat-list">
                        <!-- Se llenar√°n din√°micamente -->
                    </div>
                </div>
            </div>

            <!-- Tab: Agentes -->
            <div id="tab-agents" class="tab-content">
                <div class="agents-header">
                    <button id="create-agent-btn" class="btn-create-agent">
                        <i data-lucide="wand-2" style="width: 18px; height: 18px;"></i>
                        <span data-i18n="agents.create">Crear Agente</span>
                    </button>
                </div>
                <div id="agents-list" class="agents-list">
                    <!-- Se llenar√°n din√°micamente -->
                </div>
            </div>
        </div>

        <div class="sidebar-footer">
            <button class="sidebar-user-btn">
                <div class="user-avatar">
                    <i data-lucide="circle-user" style="width: 20px; height: 20px;"></i>
                </div>
                <div class="user-info">
                    <div class="user-name">Usuario</div>
                    <div class="user-plan">Plan Gratuito</div>
                </div>
                <i data-lucide="chevron-up" style="width: 20px; height: 20px;"></i>
            </button>
        </div>
    </aside>

    <!-- Overlay para cerrar sidebar al hacer click fuera -->
    <div id="sidebar-overlay" class="sidebar-overlay"></div>

    <!-- Bot√≥n para mostrar/ocultar sidebar en m√≥vil -->
    <button id="sidebar-toggle" class="sidebar-toggle" aria-label="Toggle Sidebar">
        <i data-lucide="panel-left" style="width: 24px; height: 24px;"></i>
    </button>

    <!-- √Årea principal del chat -->
    <main class="chat-main">
        <!-- Sidebar de plantillas -->
        <aside class="templates-sidebar">
            <div class="sidebar-header">
                <i data-lucide="settings-2" style="width: 18px; height: 18px;"></i>
                <h3>Plantillas</h3>
            </div>
            <div class="template-list">
                <button class="template-item" data-template="conservador">
                    <span class="template-emoji">üõ°Ô∏è</span>
                    <span class="template-name">Conservador</span>
                </button>
                <button class="template-item active" data-template="balanceado">
                    <span class="template-emoji">‚öñÔ∏è</span>
                    <span class="template-name">Balanceado</span>
                </button>
                <button class="template-item" data-template="creativo">
                    <span class="template-emoji">üé®</span>
                    <span class="template-name">Creativo</span>
                </button>
                <button class="template-item" data-template="preciso">
                    <span class="template-emoji">üéØ</span>
                    <span class="template-name">Preciso</span>
                </button>
                <button class="template-item" data-template="conversacional">
                    <span class="template-emoji">üí¨</span>
                    <span class="template-name">Conversacional</span>
                </button>
                <button class="template-item" data-template="tecnico">
                    <span class="template-emoji">üîß</span>
                    <span class="template-name">T√©cnico</span>
                </button>
                <button class="template-item" data-template="conciso">
                    <span class="template-emoji">‚ö°</span>
                    <span class="template-name">Conciso</span>
                </button>
                <button class="template-item" data-template="detallado">
                    <span class="template-emoji">üìö</span>
                    <span class="template-name">Detallado</span>
                </button>
                <button class="template-item" data-template="experimental">
                    <span class="template-emoji">üß™</span>
                    <span class="template-name">Experimental</span>
                </button>
                <button class="template-item" data-template="gemma_optimizado">
                    <span class="template-emoji">‚ú®</span>
                    <span class="template-name">Capibara6 Optimizado</span>
                </button>
            </div>
            <div class="sidebar-footer">
                <button id="show-template-stats-sidebar" class="btn-stats-sidebar" title="Ver estad√≠sticas">
                    <i data-lucide="bar-chart-3" style="width: 16px; height: 16px;"></i>
                    <span>Estad√≠sticas</span>
                </button>
            </div>
            <div id="template-description-sidebar" class="template-description-sidebar">
                Equilibrio entre coherencia y creatividad
            </div>
        </aside>

        <!-- Contenedor del contenido del chat -->
        <div class="chat-content-wrapper">
        <!-- Vista vac√≠a (sin conversaci√≥n seleccionada) -->
        <div id="empty-state" class="empty-state">
            <div class="empty-state-content">
                <div class="capibara-logo-large">
                    <h1 class="logo-gradient">capibara6</h1>
                    <div class="consensus-badge" style="margin-top: 10px;">
                        <i data-lucide="network" style="width: 14px; height: 14px;"></i>
                        <span>Consensus System</span>
                    </div>
                </div>
                <h2 class="empty-state-title" data-i18n="chat.empty.title">¬øEn qu√© puedo ayudarte hoy?</h2>
                <p class="empty-state-subtitle" data-i18n="chat.empty.subtitle">Sistema de IA con modelo GPT-OSS 20B (20.9B par√°metros) - Powered by Ollama</p>
                
                <div class="suggestion-cards">
                    <button class="suggestion-card" data-prompt="¬øQu√© es el sistema de Consenso de Capibara6 y c√≥mo funciona?">
                        <i data-lucide="network" style="width: 24px; height: 24px;"></i>
                        <div>
                            <div class="suggestion-title" data-i18n="chat.suggestion1.title">Sistema de Consenso</div>
                            <div class="suggestion-text" data-i18n="chat.suggestion1.text">Expl√≠came c√≥mo funciona</div>
                        </div>
                    </button>

                    <button class="suggestion-card" data-prompt="¬øQu√© caracter√≠sticas tiene el modelo GPT-OSS 20B?">
                        <i data-lucide="cpu" style="width: 24px; height: 24px;"></i>
                        <div>
                            <div class="suggestion-title" data-i18n="chat.suggestion2.title">Modelo GPT-OSS 20B</div>
                            <div class="suggestion-text" data-i18n="chat.suggestion2.text">20.9B par√°metros</div>
                        </div>
                    </button>

                    <button class="suggestion-card" data-prompt="Ay√∫dame a escribir c√≥digo Python eficiente y bien estructurado">
                        <i data-lucide="terminal" style="width: 24px; height: 24px;"></i>
                        <div>
                            <div class="suggestion-title" data-i18n="chat.suggestion3.title">Programaci√≥n</div>
                            <div class="suggestion-text" data-i18n="chat.suggestion3.text">Ayuda con c√≥digo Python</div>
                        </div>
                    </button>

                    <button class="suggestion-card" data-prompt="¬øQu√© servicios adicionales ofrece Capibara6? (TTS, MCP, N8N)">
                        <i data-lucide="sparkles" style="width: 24px; height: 24px;"></i>
                        <div>
                            <div class="suggestion-title" data-i18n="chat.suggestion4.title">Servicios</div>
                            <div class="suggestion-text" data-i18n="chat.suggestion4.text">TTS, MCP y m√°s</div>
                        </div>
                    </button>
                </div>
            </div>
        </div>

        <!-- √Årea de conversaci√≥n -->
        <div id="chat-area" class="chat-area" style="display: none;">
            <div class="chat-header">
                <button id="sidebar-toggle-header" class="btn-icon">
                    <i data-lucide="panel-left" style="width: 20px; height: 20px;"></i>
                </button>
                <div class="chat-title">
                    <span id="current-chat-title">Nueva Conversaci√≥n</span>
                </div>
                <div class="chat-actions">
                    <!-- Indicador de modelo activo -->
                    <div class="active-model-indicator" id="active-model-indicator">
                        <div class="model-indicator-icon">ü¶´</div>
                        <div class="model-indicator-text">
                            <div class="model-indicator-name">GPT-OSS 20B</div>
                            <div class="model-indicator-params">20.9B params</div>
                        </div>
                    </div>
                    <!-- Badges de servicios activos -->
                    <div class="service-badges" id="service-badges-container">
                        <!-- Se llenar√°n din√°micamente -->
                    </div>
                    <!-- Indicador de estado del servidor -->
                    <div class="server-status" id="server-status" title="Estado del servidor">
                        <div class="status-led" id="status-led"></div>
                        <span class="status-text" id="status-text">Desconectado</span>
                    </div>
                    <button class="btn-icon" title="Compartir" data-i18n-title="chat.share">
                        <i data-lucide="link-2" style="width: 20px; height: 20px;"></i>
                    </button>
                    <button class="btn-services-panel" onclick="toggleServicesPanel()" title="Panel de Control">
                        <i data-lucide="sliders-horizontal" style="width: 16px; height: 16px;"></i>
                        <span>Control</span>
                    </button>
                </div>
            </div>

            <!-- Banner Beta Experimental -->
            <div class="beta-banner">
                <i data-lucide="flask-conical" style="width: 16px; height: 16px;"></i>
                <span><strong>Capibara6 Consensus - Beta</strong> - Sistema de IA con GPT-OSS 20B (20.9B par√°metros). En desarrollo activo.</span>
                <button class="beta-banner-close" onclick="this.parentElement.style.display='none'" title="Cerrar">
                    <i data-lucide="x" style="width: 14px; height: 14px;"></i>
                </button>
            </div>

            <div id="messages-container" class="messages-container">
                <!-- Los mensajes se agregar√°n aqu√≠ din√°micamente -->
            </div>

            <!-- √Årea de input -->
            <div class="chat-input-container">
                <!-- Archivos adjuntos -->
                <div id="attachments-preview" class="attachments-preview" style="display: none;"></div>
                
                <div class="chat-input-wrapper">
                    <button id="attach-btn" class="btn-icon" title="Adjuntar archivo" data-i18n-title="chat.attach">
                        <i data-lucide="plus-circle" style="width: 20px; height: 20px;"></i>
                    </button>
                    <input type="file" id="file-input" style="display: none;" multiple accept="image/*,.pdf,.doc,.docx,.txt,.csv,.xlsx,.xls,.pptx,.ppt,.zip,.rar">
                    
                    <textarea 
                        id="message-input" 
                        class="message-input" 
                        placeholder="Escribe tu mensaje aqu√≠..."
                        data-i18n-placeholder="chat.input.placeholder"
                        rows="1"
                    ></textarea>
                    
                    <button id="send-btn" class="btn-send" disabled>
                        <i data-lucide="arrow-up" style="width: 20px; height: 20px;"></i>
                    </button>
                </div>
                <div class="chat-input-footer">
                    <span class="input-hint" data-i18n="chat.input.hint">
                        Capibara6 puede cometer errores. Considera verificar informaci√≥n importante.
                    </span>
                </div>
            </div>
        </div>
        </div> <!-- Cierre de chat-content-wrapper -->
    </main>

    <!-- Modal de configuraci√≥n -->
    <div id="settings-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2 data-i18n="settings.title">Configuraci√≥n</h2>
                <button class="modal-close" onclick="closeSettingsModal()">
                    <i data-lucide="x-circle" style="width: 24px; height: 24px;"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="setting-group">
                    <label class="setting-label" data-i18n="settings.model">Modelo</label>
                    <select class="setting-select">
                        <option value="capibara6">Capibara6 (Est√°ndar)</option>
                        <option value="capibara6-fast">Capibara6 Fast</option>
                        <option value="capibara6-advanced">Capibara6 Advanced</option>
                    </select>
                </div>
                <div class="setting-group">
                    <label class="setting-label" data-i18n="settings.temperature">Temperatura (Creatividad)</label>
                    <input type="range" class="setting-range" min="0" max="1" step="0.1" value="0.7">
                    <span class="setting-value">0.7</span>
                </div>
                <div class="setting-group">
                    <label class="setting-label" data-i18n="settings.language">Idioma</label>
                    <select class="setting-select" id="language-select">
                        <option value="es">Espa√±ol</option>
                        <option value="en">English</option>
                    </select>
                </div>
            </div>
        </div>
    </div>

    <script src="translations.js?v=5.0"></script>
    <script src="entropy-monitor.js?v=5.0"></script>
    <!-- <script src="mcp-integration.js"></script> MCP v1 (reemplazado por Smart MCP v2) -->
    <script src="smart-mcp-integration.js?v=11.0"></script>
    <!-- <script src="consensus-integration.js"></script> Pausado: Activar m√°s tarde -->
    <script src="template-profiles.js?v=5.0"></script>
    <script src="rating-system.js?v=5.0"></script>
    <script src="tts-integration.js?v=18.0"></script>
    <script src="consensus-ui.js?v=1.0"></script>
    <script src="chat-app.js?v=35.0&t=1736987000"></script>
    <script src="entropy-auto-inject.js?v=5.0"></script>
    <script>
        // Verificaci√≥n de carga de m√≥dulos
        console.log('üîç Verificando m√≥dulos cargados...');
        console.log('‚úì Lucide:', typeof lucide);
        console.log('‚úì Marked:', typeof marked);
        console.log('‚úì Template Profiles:', typeof window.TEMPLATE_PROFILES);
        console.log('‚úì Rating System:', typeof window.showRatingModal);
        console.log('‚úì Smart MCP:', typeof window.smartMCPAnalyze);

        // Inicializar iconos de Lucide
        if (typeof lucide !== 'undefined') {
            lucide.createIcons();
            console.log('‚úÖ Iconos de Lucide inicializados');
        } else {
            console.error('‚ùå Lucide no cargado');
        }

        // Manejar clics en plantillas del sidebar
        document.addEventListener('DOMContentLoaded', () => {
            const templateButtons = document.querySelectorAll('.template-item');
            const descriptionSidebar = document.getElementById('template-description-sidebar');
            
            templateButtons.forEach(button => {
                button.addEventListener('click', () => {
                    // Remover clase active de todos
                    templateButtons.forEach(btn => btn.classList.remove('active'));
                    // Agregar clase active al clickeado
                    button.classList.add('active');
                    
                    // Aplicar plantilla
                    const templateId = button.getAttribute('data-template');
                    if (window.applyTemplate) {
                        window.applyTemplate(templateId);
                    }
                    
                    // Actualizar descripci√≥n
                    if (window.TEMPLATE_PROFILES && window.TEMPLATE_PROFILES[templateId]) {
                        descriptionSidebar.textContent = window.TEMPLATE_PROFILES[templateId].description;
                    }
                });
            });

            // Bot√≥n de estad√≠sticas en sidebar
            const statsBtn = document.getElementById('show-template-stats-sidebar');
            if (statsBtn) {
                statsBtn.addEventListener('click', () => {
                    if (window.showDetailedStats) {
                        window.showDetailedStats();
                    }
                });
            }
        });
    </script>
</body>
</html>

